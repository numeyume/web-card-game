# 🎴 Web Card Game - 機能仕様書

## 📋 概要

Web Card Game は React + Node.js で構築されたリアルタイムマルチプレイヤーカードゲームです。
ドミニオンルールをベースとした戦略カードゲームで、オリジナルカード作成機能を備えています。

### 🎯 プロジェクトの特徴
- **✅ 完全実装**: CPU対戦ドミニオンゲーム
- **✅ 完全実装**: カード作成システム
- **✅ 完全実装**: MongoDB統合（フォールバック対応）
- **⚠️ 部分実装**: マルチプレイヤー対戦
- **✅ 完全実装**: デプロイメント対応（Vercel/Netlify）

---

## 🏗 システム構成

### フロントエンド
- **React 18** + TypeScript + Vite
- **Tailwind CSS** でモダンUI
- **Framer Motion** でスムーズアニメーション
- **Socket.io Client** でリアルタイム通信

### バックエンド
- **Node.js 18** + Express
- **Socket.io** でWebSocket通信
- **MongoDB** + フォールバックストレージ
- **モジュラーエンジン設計** で拡張性確保

---

## 🎮 完了済み機能

### 1. CPU対戦ドミニオンゲーム ✅

#### 基本ゲームフロー
1. **3フェーズ制システム**
   - **アクションフェーズ**: アクションカードをプレイ
   - **購入フェーズ**: 財宝カードで新しいカードを購入
   - **クリーンアップフェーズ**: 手札とプレイエリアを捨て札に

2. **デッキ管理システム**
   - 山札・手札・捨て札・プレイエリアの4領域管理
   - 自動シャッフル機能
   - カードドロー処理

3. **CPU AI戦略**
   - **3段階難易度**: Easy / Normal / Hard
   - **戦略的思考**: カード優先度算出
   - **段階的購入戦略**: ゲーム段階に応じた戦術変更
   - **思考時間シミュレーション**: 自然なゲーム体験

#### 勝利条件システム
- 属州カード枯渇での即座終了
- 3つのサプライ枯渇での即座終了
- 最大ターン数制限でのスコア勝負

#### カード効果システム
```javascript
// 実装済み効果
- draw: カードドロー
- gain_coin: コイン獲得
- gain_action: アクション追加
- gain_buy: 購入権追加
- attack: 攻撃効果
```

### 2. カード作成システム ✅

#### CardBuilder機能
- **リアルタイムバリデーション**: 入力時即座に検証
- **自動カテゴリ分類**: 効果に基づく自動分類
- **効果組み合わせ**: 最大3つの効果を組み合わせ
- **ライブプレビュー**: 作成中のカードを即座に確認
- **JSON出力**: デバッグ用データ出力

#### バリデーションルール
```javascript
// 実装済みバリデーション
- カード名: 必須、1-30文字
- 説明文: 必須、1-200文字
- コスト: 0-20の範囲
- 効果値: 各効果ごとに適切な範囲制限
```

#### 効果パネル
- **ドラッグ&ドロップ**: 直感的な効果編集
- **効果値調整**: スライダーでの数値調整
- **効果削除**: 簡単な効果除去

### 3. カードコレクション管理 ✅

#### 一覧・検索機能
- **全カード表示**: 作成済み全カードの一覧
- **検索機能**: カード名・説明文での検索
- **タイプフィルター**: カードタイプでの絞り込み
- **ソート機能**: 名前・コスト・作成日時でのソート

#### 詳細表示
- **カード詳細モーダル**: 全情報の詳細表示
- **統計情報**: タイプ別カード数統計
- **カードプレビュー**: ゲーム内表示と同じ見た目

### 4. チュートリアルシステム ✅

#### 学習コンテンツ
- **ドミニオンルール説明**: 基本ルールの丁寧な解説
- **操作方法ガイド**: UI操作の手順説明
- **インタラクティブ学習**: 実際の操作を通じた学習
- **段階的進行**: 初心者から上級者まで対応

### 5. データベース統合 ✅

#### MongoDB統合
```javascript
// 実装済みコレクション
- cards: カードデータ
- rooms: ゲームルーム
- users: 匿名ユーザー
- analytics: 使用統計
```

#### フォールバック機能
- **自動切り替え**: MongoDB接続失敗時に自動切り替え
- **メモリストレージ**: 同等機能をメモリ内で提供
- **透明な処理**: アプリケーション層では同じAPI

### 6. デプロイメント対応 ✅

#### Vercel設定 (推奨)
```json
{
  "version": 2,
  "builds": [
    {
      "src": "client/package.json",
      "use": "@vercel/static-build"
    },
    {
      "src": "server/index.js", 
      "use": "@vercel/node"
    }
  ]
}
```

#### Netlify設定
```toml
[build]
  base = "client"
  publish = "client/dist"
  command = "npm run build"
```

---

## ⚠️ 部分実装機能

### 1. マルチプレイヤー対戦

#### 実装済み部分
- **基本フレームワーク**: ルーム作成・参加
- **WebSocketイベント**: 基本的な通信設定
- **プレイヤー管理**: ルーム内プレイヤー追跡

#### 未完成部分
- **リアルタイム同期**: ゲーム状態の完全同期
- **ターン制御**: プレイヤー間のターン管理
- **競合処理**: 同時操作の競合解決

### 2. WebSocket通信

#### 安定機能
- **CPU対戦**: 完全に安定した通信
- **ルーム管理**: 基本的なルーム操作

#### 不安定機能  
- **マルチプレイヤー同期**: 状態同期エラー
- **接続管理**: 再接続処理

---

## 🚀 技術的詳細

### アーキテクチャ設計

#### クライアント側
```
/client/src/
├── components/          # React コンポーネント
│   ├── DominionGameBoard/  # メインゲーム画面
│   ├── CardBuilder/        # カード作成
│   ├── CardCollection/     # カード管理
│   ├── Tutorial/          # チュートリアル
│   └── Lobby.tsx         # ロビー画面
├── utils/
│   ├── DominionEngine.ts  # ゲームロジック
│   └── LocalCPUEngine.ts # CPU AI
└── types/
    └── index.ts          # 型定義
```

#### サーバー側
```
/server/src/
├── engine/              # ゲームエンジン群
│   ├── singlePlayerEngine.js    # CPU対戦
│   ├── cpuPlayerEngine.js      # CPU AI
│   ├── deckEngine.js          # デッキ管理
│   ├── scoringEngine.js       # スコア計算
│   └── endConditionEngine.js  # 終了条件
├── services/
│   ├── DatabaseService.js     # DB操作
│   └── GameEngineManager.js   # エンジン管理
└── routes/
    └── gameEngine.js          # API エンドポイント
```

### API仕様

#### REST API
```javascript
// カード管理
POST   /api/cards          // カード作成
GET    /api/cards          // カード一覧
PUT    /api/cards/:id      // カード更新
DELETE /api/cards/:id      // カード削除

// ルーム管理  
GET    /api/rooms          // ルーム一覧
POST   /api/rooms          // ルーム作成

// システム
GET    /health             // ヘルスチェック
```

#### WebSocket イベント
```javascript
// CPU対戦
startSinglePlayer    // ゲーム開始
playCard            // カードプレイ
buyCard             // カード購入
endTurnSinglePlayer // ターン終了

// ルーム管理
joinRoom            // ルーム参加
leaveRoom           // ルーム退出
startGame           // ゲーム開始
```

### スコアリングシステム

#### Formula 4.4 実装
```javascript
// GameScore = Victory Points × Base Multiplier
// CreatorScore = (Others' usage × 10) + (Own usage × 5)  
// TotalScore = GameScore + CreatorScore
```

---

## 📊 実装状況サマリー

### ✅ 完了機能 (90%)
1. **CPU対戦ドミニオンゲーム** - 完全実装
2. **カード作成システム** - 完全実装  
3. **カード管理システム** - 完全実装
4. **チュートリアル** - 完全実装
5. **データベース統合** - 完全実装
6. **デプロイメント** - 完全実装

### ⚠️ 部分実装 (30%) 
1. **マルチプレイヤー対戦** - 基本フレームワークのみ
2. **リアルタイム同期** - 不安定

### ❌ 未実装 (0%)
1. **完全なマルチプレイヤー対戦**
2. **観戦モード**
3. **ユーザー認証システム**
4. **カード共有システム**

---

## 🎯 使用方法

### 開発環境起動
```bash
npm run dev          # 自動復旧機能付き起動
npm run dev:safe     # 強制クリーンアップ後起動
npm run stop         # 安全な停止
```

### アクセス
- **フロントエンド**: http://localhost:5173/
- **バックエンド**: http://localhost:3001/
- **ヘルスチェック**: http://localhost:3001/health

### デプロイ
```bash
npm run build        # プロダクションビルド
vercel --prod        # Vercel デプロイ
netlify deploy --prod # Netlify デプロイ
```

---

## 🔮 今後の拡張予定

### Phase 1: マルチプレイヤー完成
- リアルタイム同期の完全実装
- ターン制御システムの安定化
- 競合処理の実装

### Phase 2: コミュニティ機能
- ユーザー認証システム
- カード共有・評価システム
- ランキング・統計機能

### Phase 3: 高度な機能
- 観戦モード
- トーナメント機能  
- カスタムルール

---

## 📋 まとめ

Web Card Game は現在、**CPU対戦ドミニオンゲーム**として完成度が高く、カード作成システムも充実した状態です。MongoDB統合とフォールバック機能により本番環境での安定性も確保されており、個人プレイヤー体験として十分に楽しめる品質に達しています。

今後マルチプレイヤー機能を完成させることで、本格的なオンラインカードゲームプラットフォームとしての地位を確立できる可能性があります。