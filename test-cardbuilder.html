<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card Builder Test</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        .card { @apply bg-zinc-800 rounded-xl p-6 border border-zinc-700; }
        .button-primary { @apply bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg font-medium transition-colors; }
    </style>
</head>
<body class="bg-zinc-900 text-white min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // „Ç∑„É≥„Éó„É´„Å™„Ç´„Éº„Éâ„Éì„É´„ÉÄ„Éº„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
        function CardBuilder() {
            const [cardName, setCardName] = useState('');
            const [cost, setCost] = useState(0);
            const [cardType, setCardType] = useState('Action');
            const [description, setDescription] = useState('');
            const [effects, setEffects] = useState([]);

            const effectTemplates = [
                { id: 'draw', name: 'Draw Cards', icon: 'üÉè', type: 'draw' },
                { id: 'coin', name: 'Gain Coins', icon: 'ü™ô', type: 'gain_coin' },
                { id: 'action', name: 'Gain Actions', icon: '‚ö°', type: 'gain_action' },
                { id: 'buy', name: 'Gain Buys', icon: 'üõí', type: 'gain_buy' },
                { id: 'attack', name: 'Attack', icon: '‚öîÔ∏è', type: 'attack' },
                { id: 'card', name: 'Gain Card', icon: 'üì•', type: 'gain_card' }
            ];

            // Ë™¨ÊòéËá™ÂãïÁîüÊàêÊ©üËÉΩ
            const generateDescription = (effectsList) => {
                if (effectsList.length === 0) return '';
                
                const descriptions = effectsList.map(effect => {
                    const template = effectTemplates.find(t => t.type === effect.type);
                    const targetText = effect.target === 'opponent' ? 'ÔºàÁõ∏Êâã„Å´Ôºâ' : 
                                     effect.target === 'all' ? 'ÔºàÂÖ®Âì°„Å´Ôºâ' : '';
                    
                    switch (effect.type) {
                        case 'draw':
                            return `„Ç´„Éº„Éâ+${effect.value}${targetText}`;
                        case 'gain_coin':
                            return `„Ç≥„Ç§„É≥+${effect.value}${targetText}`;
                        case 'gain_action':
                            return `„Ç¢„ÇØ„Ç∑„Éß„É≥+${effect.value}${targetText}`;
                        case 'gain_buy':
                            return `Ë≥ºÂÖ•+${effect.value}${targetText}`;
                        case 'attack':
                            return `ÊîªÊíÉ${effect.value}${targetText}`;
                        case 'gain_card':
                            return `„Ç´„Éº„ÉâÁç≤Âæó${effect.value}${targetText}`;
                        default:
                            return `${template?.name}+${effect.value}${targetText}`;
                    }
                });
                
                return descriptions.join('„ÄÅ') + '„ÇíÂæó„Çã„ÄÇ';
            };

            const addEffect = (template) => {
                if (effects.length >= 3) {
                    alert('ÊúÄÂ§ß3„Å§„Åæ„Åß„ÅÆ„Ç®„Éï„Çß„ÇØ„Éà„Åß„Åô');
                    return;
                }
                
                const newEffect = {
                    type: template.type,
                    value: 1,
                    target: 'self'
                };
                
                const newEffects = [...effects, newEffect];
                setEffects(newEffects);
                
                // Ë™¨Êòé„ÇíËá™ÂãïÁîüÊàê
                const autoDescription = generateDescription(newEffects);
                setDescription(autoDescription);
            };

            const removeEffect = (index) => {
                const newEffects = effects.filter((_, i) => i !== index);
                setEffects(newEffects);
                
                // Ë™¨Êòé„ÇíËá™ÂãïÊõ¥Êñ∞
                const autoDescription = generateDescription(newEffects);
                setDescription(autoDescription);
            };

            const updateEffect = (index, field, value) => {
                const newEffects = [...effects];
                newEffects[index][field] = value;
                setEffects(newEffects);
                
                // Ë™¨Êòé„ÇíËá™ÂãïÊõ¥Êñ∞
                const autoDescription = generateDescription(newEffects);
                setDescription(autoDescription);
            };

            const generateCard = () => {
                const card = {
                    id: `custom_${Date.now()}`,
                    name: cardName || 'Untitled Card',
                    cost: cost,
                    type: cardType,
                    effects: effects,
                    description: description || 'No description',
                    createdAt: new Date().toISOString()
                };

                console.log('Generated Card:', card);
                alert('„Ç´„Éº„Éâ„ÅåÁîüÊàê„Åï„Çå„Åæ„Åó„ÅüÔºÅÔºà„Ç≥„É≥„ÇΩ„Éº„É´„ÅßJSON„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºâ');
                return card;
            };

            return (
                <div className="min-h-screen bg-zinc-900 text-white p-6">
                    <div className="max-w-7xl mx-auto">
                        <h1 className="text-3xl font-bold mb-8 text-center">üé¥ Card Builder Test</h1>
                        
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            {/* Â∑¶ÂÅ¥: „Ç´„Éº„ÉâË®≠ÂÆö */}
                            <div className="space-y-6">
                                {/* Âü∫Êú¨ÊÉÖÂ†± */}
                                <div className="card">
                                    <h2 className="text-xl font-semibold mb-4">Âü∫Êú¨ÊÉÖÂ†±</h2>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-2">„Ç´„Éº„ÉâÂêç</label>
                                            <input
                                                type="text"
                                                value={cardName}
                                                onChange={(e) => setCardName(e.target.value)}
                                                className="w-full px-3 py-2 bg-zinc-700 border border-zinc-600 rounded-lg text-white"
                                                placeholder="‰æã: Êùë"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">„Ç≥„Çπ„Éà</label>
                                            <input
                                                type="number"
                                                value={cost}
                                                onChange={(e) => setCost(parseInt(e.target.value) || 0)}
                                                min="0"
                                                max="10"
                                                className="w-full px-3 py-2 bg-zinc-700 border border-zinc-600 rounded-lg text-white"
                                            />
                                        </div>
                                    </div>
                                    <div className="mt-4">
                                        <label className="block text-sm font-medium mb-2">„Çø„Ç§„Éó</label>
                                        <select
                                            value={cardType}
                                            onChange={(e) => setCardType(e.target.value)}
                                            className="w-full px-3 py-2 bg-zinc-700 border border-zinc-600 rounded-lg text-white"
                                        >
                                            <option value="Action">Action</option>
                                            <option value="Treasure">Treasure</option>
                                            <option value="Victory">Victory</option>
                                            <option value="Custom">Custom</option>
                                        </select>
                                    </div>
                                    <div className="mt-4">
                                        <label className="block text-sm font-medium mb-2">Ë™¨Êòé</label>
                                        <textarea
                                            value={description}
                                            onChange={(e) => setDescription(e.target.value)}
                                            className="w-full px-3 py-2 bg-zinc-700 border border-zinc-600 rounded-lg text-white"
                                            rows="3"
                                            placeholder="‰æã: „Ç¢„ÇØ„Ç∑„Éß„É≥+2„ÄÅ„Ç´„Éº„Éâ+1„ÇíÂæó„Çã"
                                        />
                                    </div>
                                </div>

                                {/* „Ç®„Éï„Çß„ÇØ„ÉàÈÅ∏Êäû */}
                                <div className="card">
                                    <h2 className="text-xl font-semibold mb-4">Âà©Áî®ÂèØËÉΩ„Å™„Ç®„Éï„Çß„ÇØ„Éà</h2>
                                    <div className="grid grid-cols-3 gap-3">
                                        {effectTemplates.map((template) => (
                                            <button
                                                key={template.id}
                                                onClick={() => addEffect(template)}
                                                className="p-3 bg-zinc-700 hover:bg-zinc-600 rounded-lg border border-zinc-600 transition-colors text-center"
                                            >
                                                <div className="text-2xl mb-1">{template.icon}</div>
                                                <div className="text-xs">{template.name}</div>
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* ÈÅ∏Êäû„Åó„Åü„Ç®„Éï„Çß„ÇØ„Éà */}
                                <div className="card">
                                    <h2 className="text-xl font-semibold mb-4">
                                        „Ç´„Éº„Éâ„Ç®„Éï„Çß„ÇØ„Éà ({effects.length}/3)
                                    </h2>
                                    {effects.length === 0 ? (
                                        <div className="text-center text-zinc-400 py-8">
                                            <div className="text-3xl mb-2">üéØ</div>
                                            <div>‰∏ä„ÅÆ„Ç®„Éï„Çß„ÇØ„Éà„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ËøΩÂä†</div>
                                        </div>
                                    ) : (
                                        <div className="space-y-3">
                                            {effects.map((effect, index) => {
                                                const template = effectTemplates.find(t => t.type === effect.type);
                                                return (
                                                    <div key={index} className="p-3 bg-zinc-700 rounded-lg border border-zinc-600">
                                                        <div className="flex items-center justify-between mb-2">
                                                            <span className="font-medium">
                                                                {template?.icon} {template?.name}
                                                            </span>
                                                            <button
                                                                onClick={() => removeEffect(index)}
                                                                className="text-red-400 hover:text-red-300"
                                                            >
                                                                ‚úï
                                                            </button>
                                                        </div>
                                                        <div className="grid grid-cols-2 gap-2">
                                                            <div>
                                                                <label className="block text-xs text-zinc-400 mb-1">ÂÄ§</label>
                                                                <input
                                                                    type="number"
                                                                    value={effect.value}
                                                                    onChange={(e) => updateEffect(index, 'value', parseInt(e.target.value) || 1)}
                                                                    min="1"
                                                                    max="10"
                                                                    className="w-full px-2 py-1 bg-zinc-800 border border-zinc-600 rounded text-sm"
                                                                />
                                                            </div>
                                                            <div>
                                                                <label className="block text-xs text-zinc-400 mb-1">ÂØæË±°</label>
                                                                <select
                                                                    value={effect.target}
                                                                    onChange={(e) => updateEffect(index, 'target', e.target.value)}
                                                                    className="w-full px-2 py-1 bg-zinc-800 border border-zinc-600 rounded text-sm"
                                                                >
                                                                    <option value="self">Ëá™ÂàÜ</option>
                                                                    <option value="opponent">Áõ∏Êâã</option>
                                                                    <option value="all">ÂÖ®Âì°</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* Âè≥ÂÅ¥: „Éó„É¨„Éì„É•„Éº */}
                            <div className="space-y-6">
                                {/* „Ç´„Éº„Éâ„Éó„É¨„Éì„É•„Éº */}
                                <div className="card">
                                    <h2 className="text-xl font-semibold mb-4">„Ç´„Éº„Éâ„Éó„É¨„Éì„É•„Éº</h2>
                                    <div className="w-64 mx-auto bg-gradient-to-b from-zinc-700 to-zinc-800 rounded-xl p-4 border border-zinc-600">
                                        <div className="flex justify-between items-center mb-2">
                                            <h3 className="font-bold text-lg">{cardName || 'Untitled Card'}</h3>
                                            <div className="bg-yellow-500 text-black rounded-full w-8 h-8 flex items-center justify-center font-bold">
                                                {cost}
                                            </div>
                                        </div>
                                        <div className="text-sm text-zinc-300 mb-3">{cardType}</div>
                                        <div className="border-t border-zinc-600 pt-3 mb-3">
                                            <div className="text-sm">{description || 'No description'}</div>
                                        </div>
                                        {effects.length > 0 && (
                                            <div className="space-y-1">
                                                {effects.map((effect, index) => {
                                                    const template = effectTemplates.find(t => t.type === effect.type);
                                                    return (
                                                        <div key={index} className="text-xs text-green-300">
                                                            {template?.icon} {template?.name} +{effect.value}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        )}
                                        <div className="mt-3 text-xs text-zinc-400 border-t border-zinc-600 pt-2">
                                            Power Level: {effects.reduce((sum, e) => sum + e.value, 0)}
                                        </div>
                                    </div>
                                </div>

                                {/* ÁîüÊàê„Éú„Çø„É≥ */}
                                <div className="card">
                                    <h2 className="text-xl font-semibold mb-4">„Ç´„Éº„ÉâÁîüÊàê</h2>
                                    <button
                                        onClick={generateCard}
                                        className="w-full button-primary text-lg py-3"
                                    >
                                        üé¥ „Ç´„Éº„Éâ„ÇíÁîüÊàê
                                    </button>
                                    <div className="mt-3 text-sm text-zinc-400">
                                        ÁîüÊàê„Åï„Çå„ÅüJSON„ÅØ„Éñ„É©„Ç¶„Ç∂„ÅÆ„Ç≥„É≥„ÇΩ„Éº„É´„ÅßÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô
                                    </div>
                                </div>

                                {/* API„ÉÜ„Çπ„Éà */}
                                <div className="card">
                                    <h2 className="text-xl font-semibold mb-4">API„ÉÜ„Çπ„Éà</h2>
                                    <div className="space-y-2">
                                        <button
                                            onClick={() => {
                                                fetch('/api/cards')
                                                    .then(res => res.json())
                                                    .then(data => {
                                                        console.log('Cards API:', data);
                                                        alert('„Ç´„Éº„ÉâAPIÊàêÂäüÔºÅ„Ç≥„É≥„ÇΩ„Éº„É´„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                                                    })
                                                    .catch(err => {
                                                        console.error('API Error:', err);
                                                        alert('APIÊé•Á∂öÂ§±Êïó: ' + err.message);
                                                    });
                                            }}
                                            className="w-full bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg transition-colors"
                                        >
                                            üì° „Ç´„Éº„Éâ‰∏ÄË¶ßAPI „ÉÜ„Çπ„Éà
                                        </button>
                                        <button
                                            onClick={() => {
                                                fetch('/health')
                                                    .then(res => res.json())
                                                    .then(data => {
                                                        console.log('Health:', data);
                                                        alert('„Çµ„Éº„Éê„ÉºÊ≠£Â∏∏: ' + data.status);
                                                    })
                                                    .catch(err => {
                                                        console.error('Health Error:', err);
                                                        alert('„Çµ„Éº„Éê„ÉºÊé•Á∂öÂ§±Êïó: ' + err.message);
                                                    });
                                            }}
                                            className="w-full bg-purple-600 hover:bg-purple-500 text-white px-4 py-2 rounded-lg transition-colors"
                                        >
                                            üíì „Éò„É´„Çπ„ÉÅ„Çß„ÉÉ„ÇØ
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // „Ç¢„Éó„É™„Çí„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        ReactDOM.render(<CardBuilder />, document.getElementById('root'));
    </script>
</body>
</html>